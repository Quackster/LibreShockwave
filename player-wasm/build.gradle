plugins {
    id 'java'
    id 'org.teavm' version '0.13.0'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // Depend on the player-core module (which depends on VM and SDK)
    implementation project(':player-core')

    // TeaVM interop for @Export/@Import (standard WASM target)
    implementation 'org.teavm:teavm-interop:0.13.0'
}

teavm {
    // Standard Wasm target (broad browser support, MVP)
    wasm {
        mainClass = 'com.libreshockwave.player.wasm.WasmPlayerApp'
        // Generate debug info for development
        debugInformation = true
    }

    all {
        // Preserve exported entry point class
        preservedClasses = ['com.libreshockwave.player.wasm.WasmPlayerApp']
    }
}

// Copy web resources alongside generated output
tasks.register('copyWebResources', Copy) {
    from 'src/main/resources/web'
    into layout.buildDirectory.dir('generated/teavm/wasm')
}

tasks.matching { it.name == 'generateWasm' }.configureEach {
    finalizedBy 'copyWebResources'
}
